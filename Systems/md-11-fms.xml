<?xml version="1.0"?>

<!-- McDonnell Douglas MD-11 FMS -->
<!-- Copyright (c) 2025 Josh Davidson (Octal450) -->

<system name="MD-11: FMS">
	
	<property value="0">/systems/fms/speeds/flaps-input-feedback</property>
	
	<channel name="Fast Logic">
		
		<!-- V2 Target Logic -->
		<!-- This is used only to make the loop update when the speed changes between V2 and V2 + 10 -->
		<fcs_function name="/systems/fms/flight-data/v2-plus-10">
			<function>
				<sum>
					<property>/systems/fms/flight-data/v2</property>
					<value>10</value>
				</sum>
			</function>
		</fcs_function>
		
		<fcs_function name="/systems/fms/internal/ias-v2-clamp">
			<function>
				<ifthen>
					<gt>
						<property>/systems/fms/flight-data/v2</property>
						<value>0</value>
					</gt>
					<ifthen>
						<eq>
							<property>position/wow</property>
							<value>0</value>
						</eq>
						<property>/systems/fms/flight-data/v2-plus-10</property>
						<floor>
							<sum>
								<property>/instrumentation/airspeed-indicator/indicated-speed-kt</property>
								<value>0.5</value>
							</sum>
						</floor>
					</ifthen>
					<value>0</value>
				</ifthen>
			</function>
			<output>/systems/fms/internal/ias-v2-clamp-out</output>
			<clipto>
				<min>/systems/fms/flight-data/v2</min>
				<max>/systems/fms/flight-data/v2-plus-10</max>
			</clipto>
		</fcs_function>
	
	</channel>
	
	<channel name="Flight Data" execrate="8">
		
		<!-- Weight Inputs -->
		<pure_gain name="/systems/fms/flight-data/gw-full-lbs">
			<input>/systems/fms/flight-data/gw-lbs</input>
			<gain>1000</gain>
		</pure_gain>
		
		<pure_gain name="/systems/fms/flight-data/gw-kg">
			<input>/systems/fms/flight-data/gw-lbs</input>
			<gain>0.45359237</gain>
		</pure_gain>
		
		<pure_gain name="/systems/fms/flight-data/gw-full-kg">
			<input>/systems/fms/flight-data/gw-full-lbs</input>
			<gain>0.45359237</gain>
		</pure_gain>
		
		<pure_gain name="/systems/fms/flight-data/togw-full-lbs">
			<input>/systems/fms/flight-data/togw-lbs</input>
			<gain>1000</gain>
		</pure_gain>
		
		<pure_gain name="/systems/fms/flight-data/togw-full-kg">
			<input>/systems/fms/flight-data/togw-full-lbs</input>
			<gain>0.45359237</gain>
		</pure_gain>
		
		<pure_gain name="/systems/fms/flight-data/zfw-full-lbs">
			<input>/systems/fms/flight-data/zfw-lbs</input>
			<gain>1000</gain>
		</pure_gain>
		
		<pure_gain name="/systems/fms/flight-data/zfw-full-kg">
			<input>/systems/fms/flight-data/zfw-full-lbs</input>
			<gain>0.45359237</gain>
		</pure_gain>
	
	</channel>
	
	<channel name="FMS Calculations" execrate="8">
		
		<!-- FMS CG Calculation -->
		<fcs_function name="/systems/fms/internal/zfwcg-x-in"> <!-- Inverted from md-11-libraries.xml -->
			<function>
				<quotient>
					<sum>
						<product>
							<quotient>
								<property>/systems/fms/flight-data/zfwcg</property> <!-- MCDU value -->
								<value>100</value>
							</quotient>
							<value>7.68</value> <!-- MAC length -->
						</product>
						<value>0.24116</value> <!-- Offset -->
					</sum>
					<value>0.0254</value> <!-- Inches to meters -->
				</quotient>
			</function>
		</fcs_function>
		
		<fcs_function name="/systems/fms/internal/cg-x-in"> <!-- Uses MCDU ZFWCG/ZFW and fuel sensors to calculate real CG -->
			<function>
				<ifthen>
					<and>
						<gt>
							<property>/systems/fms/flight-data/zfwcg</property>
							<value>0</value>
						</gt>
						<gt>
							<property>/systems/fms/flight-data/zfw-lbs</property>
							<value>0</value>
						</gt>
					</and>
					<quotient> <!-- Weighted average -->
						<sum>
							<product> <!-- Undo the quotient done to get ZFWCG position but with MCDU value -->
								<property>/systems/fms/internal/zfwcg-x-in</property>
								<property>/systems/fms/flight-data/zfw-full-lbs</property>
							</product>
							<product>
								<property>propulsion/tank[0]/contents-lbs</property>
								<property>propulsion/tank[0]/x-position</property>
							</product>
							<product>
								<property>propulsion/tank[1]/contents-lbs</property>
								<property>propulsion/tank[1]/x-position</property>
							</product>
							<product>
								<property>propulsion/tank[2]/contents-lbs</property>
								<property>propulsion/tank[2]/x-position</property>
							</product>
							<product>
								<property>propulsion/tank[3]/contents-lbs</property>
								<property>propulsion/tank[3]/x-position</property>
							</product>
							<product>
								<property>propulsion/tank[4]/contents-lbs</property>
								<property>propulsion/tank[4]/x-position</property>
							</product>
							<product>
								<property>propulsion/tank[5]/contents-lbs</property>
								<property>propulsion/tank[5]/x-position</property>
							</product>
							<product>
								<property>propulsion/tank[6]/contents-lbs</property>
								<property>propulsion/tank[6]/x-position</property>
							</product>
							<product>
								<property>propulsion/tank[7]/contents-lbs</property>
								<property>propulsion/tank[7]/x-position</property>
							</product>
						</sum>
						<sum>
							<property>/systems/fms/flight-data/zfw-full-lbs</property>
							<property>propulsion/tank[0]/contents-lbs</property>
							<property>propulsion/tank[1]/contents-lbs</property>
							<property>propulsion/tank[2]/contents-lbs</property>
							<property>propulsion/tank[3]/contents-lbs</property>
							<property>propulsion/tank[4]/contents-lbs</property>
							<property>propulsion/tank[5]/contents-lbs</property>
							<property>propulsion/tank[6]/contents-lbs</property>
							<property>propulsion/tank[7]/contents-lbs</property>
						</sum>
					</quotient>
					<value>0</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<fcs_function name="/systems/fms/internal/cg-percent-mac"> <!-- From md-11-libraries.xml -->
			<function>
				<product>
					<quotient>
						<difference>
							<product>
								<property>/systems/fms/internal/cg-x-in</property>
								<value>0.0254</value> <!-- Inches to meters -->
							</product>
							<value>0.24116</value> <!-- Offset -->
						</difference>
						<value>7.68</value> <!-- MAC length -->
					</quotient>
					<value>100</value>
				</product>
			</function>
		</fcs_function>
		
		<!-- Vmo/Mmo -->
		<fcs_function name="/systems/fms/speeds/vmo-mmo-sel"> <!-- 60% to 90% scale of tip tanks -->
			<function>
				<avg>
					<table>
						<independentVar lookup="row">propulsion/tank[0]/contents-lbs</independentVar>
						<tableData>
							3900  1
							5850  0
						</tableData>
					</table>
					<table>
						<independentVar lookup="row">propulsion/tank[4]/contents-lbs</independentVar>
						<tableData>
							3900  1
							5850  0
						</tableData>
					</table>
				</avg>
			</function>
		</fcs_function>
		
		<fcs_function name="/systems/fms/speeds/vmo-kts"> <!-- From FCOM -->
			<function>
				<table>
					<independentVar lookup="row">/instrumentation/altimeter/indicated-altitude-ft</independentVar>
					<independentVar lookup="column">/systems/fms/speeds/vmo-mmo-sel</independentVar>
					<tableData> <!-- I disregarded the data from 25700/30700 and up because its just the MMO limit, which I do more accurately below -->
						       0    1
						    0  350  320
						10200  365  320
					</tableData>
				</table>
			</function>
		</fcs_function>
		
		<fcs_function name="/systems/fms/speeds/mmo-kts">
			<function>
				<product>
					<quotient>
						<property>/instrumentation/airspeed-indicator/indicated-speed-kt</property>
						<max> <!-- Prevent divide by 0 -->
							<property>/instrumentation/airspeed-indicator/indicated-mach</property>
							<value>0.0001</value>
						</max>
					</quotient>
					<table>
						<independentVar lookup="row">/systems/fms/speeds/vmo-mmo-sel</independentVar>
						<tableData>
							0  0.87
							1  0.85
						</tableData>
					</table>
				</product>
			</function>
		</fcs_function>
		
		<switch name="/systems/fms/speeds/vmo-mmo">
			<default value="/systems/fms/speeds/vmo-kts"/>
			<test logic="AND" value="/systems/fms/speeds/mmo-kts">
				/systems/fms/speeds/mmo-kts lt /systems/fms/speeds/vmo-kts
				position/wow eq 0
				/sim/time/elapsed-sec gt 0
			</test>
		</switch>
		
		<!-- Gear Max -->
		<fcs_function name="/systems/fms/speeds/gear-max-mach-kts">
			<function>
				<product>
					<quotient>
						<property>/instrumentation/airspeed-indicator/indicated-speed-kt</property>
						<max> <!-- Prevent divide by 0 -->
							<property>/instrumentation/airspeed-indicator/indicated-mach</property>
							<value>0.0001</value>
						</max>
					</quotient>
					<value>0.7</value>
				</product>
			</function>
		</fcs_function>
		
		<switch name="/systems/fms/speeds/gear-max-kts">
			<default value="300"/>
			<test logic="AND" value="/systems/fms/speeds/gear-max-mach-kts">
				/systems/fms/speeds/gear-max-mach-kts lt 300
				position/wow eq 0
				/sim/time/elapsed-sec gt 0
			</test>
		</switch>
		
		<switch name="/systems/fms/speeds/gear-ext-max-kts">
			<default value="260"/>
			<test logic="AND" value="/systems/fms/speeds/gear-max-mach-kts">
				/systems/fms/speeds/gear-max-mach-kts lt 260
				position/wow eq 0
				/sim/time/elapsed-sec gt 0
			</test>
		</switch>
		
		<switch name="/systems/fms/speeds/gear-ret-max-kts">
			<default value="230"/>
			<test logic="AND" value="/systems/fms/speeds/gear-max-mach-kts">
				/systems/fms/speeds/gear-max-mach-kts lt 230
				position/wow eq 0
				/sim/time/elapsed-sec gt 0
			</test>
		</switch>
		
		<!-- Slat Max -->
		<fcs_function name="/systems/fms/speeds/slat-max-mach-kts">
			<function>
				<product>
					<quotient>
						<property>/instrumentation/airspeed-indicator/indicated-speed-kt</property>
						<max> <!-- Prevent divide by 0 -->
							<property>/instrumentation/airspeed-indicator/indicated-mach</property>
							<value>0.0001</value>
						</max>
					</quotient>
					<value>0.55</value>
				</product>
			</function>
		</fcs_function>
		
		<switch name="/systems/fms/speeds/slat-max-kts">
			<default value="280"/>
			<test logic="AND" value="/systems/fms/speeds/slat-max-mach-kts">
				/systems/fms/speeds/slat-max-mach-kts lt 280
				position/wow eq 0
				/sim/time/elapsed-sec gt 0
			</test>
		</switch>
		
		<!-- Flap Max -->
		<fcs_function name="/systems/fms/speeds/flap-max-mach-kts">
			<function>
				<product>
					<quotient>
						<property>/instrumentation/airspeed-indicator/indicated-speed-kt</property>
						<max> <!-- Prevent divide by 0 -->
							<property>/instrumentation/airspeed-indicator/indicated-mach</property>
							<value>0.0001</value>
						</max>
					</quotient>
					<value>0.51</value>
				</product>
			</function>
		</fcs_function>
		
		<switch name="/systems/fms/speeds/flap-0-15-max-kts">
			<default value="255"/>
			<test logic="AND" value="/systems/fms/speeds/flap-max-mach-kts">
				/systems/fms/speeds/flap-max-mach-kts lt 255
				position/wow eq 0
				/sim/time/elapsed-sec gt 0
			</test>
		</switch>
		
		<switch name="/systems/fms/speeds/flap-15-20-max-kts">
			<default value="240"/>
			<test logic="AND" value="/systems/fms/speeds/flap-max-mach-kts">
				/systems/fms/speeds/flap-max-mach-kts lt 240
				position/wow eq 0
				/sim/time/elapsed-sec gt 0
			</test>
		</switch>
		
		<switch name="/systems/fms/speeds/flap-20-25-max-kts">
			<default value="220"/>
			<test logic="AND" value="/systems/fms/speeds/flap-max-mach-kts">
				/systems/fms/speeds/flap-max-mach-kts lt 220
				position/wow eq 0
				/sim/time/elapsed-sec gt 0
			</test>
		</switch>
		
		<switch name="/systems/fms/speeds/flap-28-max-kts">
			<default value="210"/>
			<test logic="AND" value="/systems/fms/speeds/flap-max-mach-kts">
				/systems/fms/speeds/flap-max-mach-kts lt 210
				position/wow eq 0
				/sim/time/elapsed-sec gt 0
			</test>
		</switch>
		
		<switch name="/systems/fms/speeds/flap-35-max-kts">
			<default value="190"/>
			<test logic="AND" value="/systems/fms/speeds/flap-max-mach-kts">
				/systems/fms/speeds/flap-max-mach-kts lt 190
				position/wow eq 0
				/sim/time/elapsed-sec gt 0
			</test>
		</switch>
		
		<switch name="/systems/fms/speeds/flap-50-max-kts">
			<default value="175"/>
			<test logic="AND" value="/systems/fms/speeds/flap-max-mach-kts">
				/systems/fms/speeds/flap-max-mach-kts lt 175
				position/wow eq 0
				/sim/time/elapsed-sec gt 0
			</test>
		</switch>
		
		<!-- Flap/Slat/Gear Max -->
		<switch name="/systems/fms/speeds/flap-gear-max">
			<default value="0"/> <!-- Hide the tape -->
			<test value="0"> <!-- Hide the tape -->
				gear/unit[0]/WOW eq 1
			</test>
			<test value="/systems/fms/speeds/flap-50-max-kts">
				fcs/flap-pos-deg ge 36
			</test>
			<test value="/systems/fms/speeds/flap-35-max-kts">
				fcs/flap-pos-deg ge 29
			</test>
			<test value="/systems/fms/speeds/flap-28-max-kts">
				fcs/flap-pos-deg ge 26
			</test>
			<test value="/systems/fms/speeds/flap-20-25-max-kts">
				fcs/flap-pos-deg ge 20.5
			</test>
			<test logic="AND" value="/systems/fms/speeds/gear-ret-max-kts">
				/systems/gear/cmd eq 0
				/gear/gear[1]/position-norm gt 0.01
			</test>
			<test value="/systems/fms/speeds/flap-15-20-max-kts">
				fcs/flap-pos-deg ge 15.5
			</test>
			<test value="/systems/fms/speeds/flap-0-15-max-kts">
				fcs/flap-pos-deg ge 1
			</test>
			<test logic="AND" value="/systems/fms/speeds/gear-ext-max-kts">
				/systems/gear/cmd eq 1
				/gear/gear[1]/position-norm lt 0.99
			</test>
			<test logic="AND" value="/systems/fms/speeds/slat-max-kts">
				fcs/slat-pos-deg ge 1
				fcs/flap-pos-deg lt 1
			</test>
			<test value="/systems/fms/speeds/gear-max-kts">
				/systems/gear/cmd eq 1
				/gear/gear[1]/position-norm ge 0.99
			</test>
		</switch>
		
		<!-- Vmax -->
		<switch name="/systems/fms/speeds/vmax">
			<default value="/systems/fms/speeds/vmo-mmo"/>
			<test value="/systems/fms/speeds/flap-gear-max">
				/systems/fms/speeds/flap-gear-max gt 0
			</test>
			<clipto>
				<min>100</min>
				<max>100000</max>
			</clipto>
		</switch>
		
		<fcs_function name="/systems/fms/speeds/athr-max">
			<function>
				<difference>
					<property>/systems/fms/speeds/vmax</property>
					<value>5</value>
				</difference>
			</function>
			<clipto>
				<min>100</min>
				<max>100000</max>
			</clipto>
		</fcs_function>
		
		<fcs_function name="/systems/fms/speeds/athr-max-mach">
			<function>
				<difference>
					<product>
						<quotient>
							<property>/instrumentation/airspeed-indicator/indicated-mach</property>
							<max> <!-- Prevent divide by 0 -->
								<property>/instrumentation/airspeed-indicator/indicated-speed-kt</property>
								<value>0.0001</value>
							</max>
						</quotient>
						<property>/systems/fms/speeds/vmax</property>
					</product>
					<value>0.005</value>
				</difference>
			</function>
			<clipto>
				<min>0.0</min>
				<max>0.87</max>
			</clipto>
		</fcs_function>
		
		<!-- Vstall -->
		<fcs_function name="/systems/fms/speeds/vss-kts">
			<function>
				<ifthen>
					<gt>
						<property>/systems/fms/flight-data/gw-full-kg</property>
						<value>0</value>
					</gt>
					<table> <!-- +15 FAA Stall -->
						<independentVar lookup="row">/systems/fms/flight-data/gw-full-kg</independentVar>
						<independentVar lookup="column">fcs/flap-pos-deg</independentVar>
						<independentVar lookup="table">fcs/slat-pos-deg</independentVar>
						<tableData breakPoint="0"> <!-- Values clipped and rounded down so Vmin (FAA Stall * 1.3) won't exceed flap max (as per manual) -->
							        0       15      25      28      35      50
							140000  149.22  141.92  137.31  136.54  134.88  133.22
							160000  158.53  150.38  146.54  145.77  143.99  141.26
							180000  167.38  158.85  154.23  153.46  151.31  147.91
							200000  175.63  166.54  161.92  160.38  157.93  149.61
							220000  183.56  174.23  168.85  168.08  161.15  149.61
							240000  190.73  181.15  175.77  175.01  161.15  149.61
							260000  198.14  188.08  182.69  176.53  161.15  149.61
							280000  204.93  195.01  184.23  176.53  161.15  149.61
						</tableData>
						<tableData breakPoint="31">
							        0       10      15      20      25      28      35      50
							140000  124.19  120.99  118.85  117.33  116.47  115.89  114.48  113.07
							160000  131.75  128.24  125.95  124.42  123.40  122.69  121.19  118.89
							180000  138.92  135.11  132.59  131.06  130.02  129.36  127.55  124.68
							200000  145.64  141.67  139.15  137.47  136.34  135.63  133.56  129.98
							220000  152.05  147.62  145.41  143.35  142.30  141.55  139.34  135.14
							240000  158.07  153.65  150.98  148.99  147.82  147.07  144.77  140.00
							260000  163.87  159.52  156.62  154.56  153.16  152.37  150.03  144.77
							280000  169.52  164.94  161.74  159.74  158.33  157.58  155.24  149.19
						</tableData>
					</table>
					<value>0</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<fcs_function name="/systems/fms/speeds/v2-latch-speed"> <!-- Based off speed in FlightData -->
			<function>
				<sum>
					<property>/systems/fms/flight-data/v2</property>
					<value>8</value> <!-- V2 + 10kts, 2 kt buffer -->
				</sum>
			</function>
		</fcs_function>
		
		<switch name="/systems/fms/speeds/v2-latch">
			<default value="/systems/fms/speeds/v2-latch"/>
			<test value="0">
				gear/unit[0]/WOW eq 1
			</test>
			<test value="1">
				/position/gear-agl-ft ge 100
			</test>
			<test logic="AND" value="1">
				/instrumentation/airspeed-indicator/indicated-speed-kt gt /systems/fms/speeds/v2-latch-speed
				/systems/fms/flight-data/v2 ne 0
			</test>
		</switch>
		
		<fcs_function name="/systems/fms/speeds/vss-roll-factor">
			<function>
				<sqrt> <!-- Take the square root to get the factor -->
					<quotient> <!-- Calculate neutral load factor from bank -->
						<value>1</value>
						<cos>
							<toradians>
								<min>
									<abs>
										<property>/orientation/roll-deg</property>
									</abs>
									<value>89</value> <!-- Above math breaks -->
								</min>
							</toradians>
						</cos>
					</quotient>
				</sqrt>
			</function>
		</fcs_function>
		
		<pure_gain name="/systems/fms/speeds/vss">
			<input>/systems/fms/speeds/vss-kts</input>
			<gain>/systems/fms/speeds/vss-roll-factor</gain>
			<clipto>
				<min>0</min>
				<max>/systems/fms/speeds/vmax</max>
			</clipto>
		</pure_gain>
		
		<switch name="/systems/fms/speeds/vss-tape">
			<default value="/systems/fms/speeds/vss"/>
			<test logic="OR" value="0"> <!-- Hide the tape until we pass speed and airbone -->
				gear/unit[0]/WOW eq 1
				/systems/fms/speeds/v2-latch ne 1
			</test>
		</switch>
		
		<!-- Vmin -->
		<switch name="/systems/fms/speeds/vmin-latch">
			<default value="/systems/fms/speeds/vmin-latch"/>
			<test value="0">
				gear/unit[0]/WOW eq 1
			</test>	
			<test logic="OR" value="1">
				/systems/fms/internal/phase ge 2
				/systems/fms/speeds/flaps-input-feedback ge 4
			</test>
		</switch>
		
		<switch name="/systems/fms/speeds/vmin-factor">
			<default value="1.3"/> <!-- 1.3 Vstall -->
			<test logic="AND" value="1.25"> <!-- 1.25 Vstall -->
				fcs/flap-pos-deg ge 0.1
				fcs/slat-pos-deg lt 0.1
				/systems/fms/speeds/vmin-latch ne 1
			</test>
			<test logic="AND" value="1.2"> <!-- 1.2 Vstall -->
				<test logic="OR">
					fcs/flap-pos-deg ge 0.1
					fcs/slat-pos-deg ge 0.1
				</test>
				/systems/fms/speeds/vmin-latch ne 1
			</test>
		</switch>
		
		<fcs_function name="/systems/fms/speeds/vmin">
			<function>
				<product>
					<difference>
						<property>/systems/fms/speeds/vss-kts</property>
						<value>15</value> <!-- FAA Stall -->
					</difference>
					<sum>
						<property>/systems/fms/speeds/vmin-factor</property>
						<table>
							<independentVar lookup="row">atmosphere/density-altitude</independentVar>
							<tableData>
								    0  0.0000
								45000  0.2302
							</tableData>
						</table>
					</sum>
				</product>
			</function>
			<clipto>
				<min>/systems/fms/speeds/vss</min>
				<max>/systems/fms/speeds/vmax</max>
			</clipto>
		</fcs_function>
		
		<switch name="/systems/fms/speeds/vmin-tape">
			<default value="/systems/fms/speeds/vmin"/>
			<test logic="OR" value="0"> <!-- Hide the tape until we pass speed and airbone or if Vstall is invalid -->
				gear/unit[0]/WOW eq 1
				/systems/fms/speeds/v2-latch ne 1
				/systems/fms/speeds/vss-tape eq 0
			</test>
		</switch>
		
		<fcs_function name="/systems/fms/speeds/athr-min">
			<function>
				<sum>
					<property>/systems/fms/speeds/vmin-tape</property>
					<value>5</value>
				</sum>
			</function>
			<clipto>
				<min>100</min>
				<max>/systems/fms/speeds/vmax</max>
			</clipto>
		</fcs_function>
		
		<fcs_function name="/systems/fms/speeds/athr-min-mach">
			<function>
				<sum>
					<product>
						<quotient>
							<property>/instrumentation/airspeed-indicator/indicated-mach</property>
							<max> <!-- Prevent divide by 0 -->
								<property>/instrumentation/airspeed-indicator/indicated-speed-kt</property>
								<value>0.0001</value>
							</max>
						</quotient>
						<property>/systems/fms/speeds/vmin-tape</property>
					</product>
					<value>0.005</value>
				</sum>
			</function>
		</fcs_function>
		
		<!-- Clean Min -->
		<fcs_function name="/systems/fms/speeds/clean-min">
			<function>
				<ifthen>
					<gt>
						<property>/systems/fms/flight-data/gw-full-kg</property>
						<value>0</value>
					</gt>
					<product>
						<difference>
							<table>
								<independentVar lookup="row">/systems/fms/flight-data/gw-full-kg</independentVar>
								<tableData>
									140000  149.22
									160000  158.53
									180000  167.38
									200000  175.63
									220000  183.56
									240000  190.73
									260000  198.14
									280000  204.93
								</tableData>
							</table>
							<value>15</value> <!-- FAA Stall -->
						</difference>
						<sum>
							<value>1.3</value>
							<table>
								<independentVar lookup="row">atmosphere/density-altitude</independentVar>
								<tableData>
										0  0.0000
									45000  0.2302
								</tableData>
							</table>
						</sum>
					</product>
					<value>0</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<!-- Slat Min -->
		<fcs_function name="/systems/fms/speeds/slat-min">
			<function>
				<ifthen>
					<gt>
						<property>/systems/fms/flight-data/gw-full-kg</property>
						<value>0</value>
					</gt>
					<product>
						<difference>
							<table>
								<independentVar lookup="row">/systems/fms/flight-data/gw-full-kg</independentVar>
								<tableData>
									140000  124.19
									160000  131.75
									180000  138.92
									200000  145.64
									220000  152.05
									240000  158.07
									260000  163.87
									280000  169.52
								</tableData>
							</table>
							<value>15</value> <!-- FAA Stall -->
						</difference>
						<sum>
							<value>1.3</value>
							<table>
								<independentVar lookup="row">atmosphere/density-altitude</independentVar>
								<tableData>
										0  0.0000
									45000  0.2302
								</tableData>
							</table>
						</sum>
					</product>
					<value>0</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<!-- Flap 28 Min -->
		<fcs_function name="/systems/fms/speeds/flap-28-min">
			<function>
				<ifthen>
					<gt>
						<property>/systems/fms/flight-data/gw-full-kg</property>
						<value>0</value>
					</gt>
					<product>
						<difference>
							<table>
								<independentVar lookup="row">/systems/fms/flight-data/gw-full-kg</independentVar>
								<tableData>
									140000  115.89
									160000  122.69
									180000  129.36
									200000  135.63
									220000  141.55
									240000  147.07
									260000  152.37
									280000  157.58
								</tableData>
							</table>
							<value>15</value> <!-- FAA Stall -->
						</difference>
						<sum>
							<value>1.3</value>
							<table>
								<independentVar lookup="row">atmosphere/density-altitude</independentVar>
								<tableData>
										0  0.0000
									45000  0.2302
								</tableData>
							</table>
						</sum>
					</product>
					<value>0</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<!-- Vref -->
		<fcs_function name="/systems/fms/speeds/vref">
			<function>
				<ifthen>
					<and>
						<gt>
							<property>/systems/fms/flight-data/gw-full-kg</property>
							<value>0</value>
						</gt>
						<gt>
							<property>/systems/fms/flight-data/airport-to-alt</property>
							<value>-2000</value>
						</gt>
					</and>
					<product>
						<difference>
							<table>
								<independentVar lookup="row">/systems/fms/flight-data/gw-full-kg</independentVar>
								<independentVar lookup="column">/systems/fms/flight-data/land-flaps</independentVar>
								<tableData>
									        35      50
									140000  114.48  113.07
									160000  121.19  118.89
									180000  127.55  124.68
									200000  133.56  129.98
									220000  139.34  135.14
									240000  144.77  140.00
									260000  150.03  144.77
									280000  155.24  149.19
								</tableData>
							</table>
							<value>15</value> <!-- FAA Stall -->
						</difference>
						<sum>
							<value>1.3</value>
							<table>
								<independentVar lookup="row">/systems/fms/flight-data/airport-to-alt</independentVar>
								<tableData>
										0  0.0000
									45000  0.2302
								</tableData>
							</table>
						</sum>
					</product>
					<value>0</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<!-- Vapp -->
		<fcs_function name="/systems/fms/speeds/vapp">
			<function>
				<ifthen>
					<and>
						<gt>
							<property>/systems/fms/flight-data/gw-full-kg</property>
							<value>0</value>
						</gt>
						<gt>
							<property>/systems/fms/flight-data/airport-to-alt</property>
							<value>-2000</value>
						</gt>
					</and>
					<sum>
						<property>/systems/fms/speeds/vref</property>
						<value>5</value>
					</sum>
					<value>0</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<!-- Vmcg -->
		<fcs_function name="/systems/fms/speeds/vmcg"> <!-- From FCOM + Correction -->
			<function>
				<table>
					<independentVar lookup="row">/position/altitude-ft</independentVar>
					<independentVar lookup="column">propulsion/tat-c</independentVar>
					<tableData>
						       15   20   25   30   35   40   45   50
						    0  137  136  136  136  134  131  129  126
						 1000  135  134  134  133  131  129  126  124
						 2000  133  132  132  131  129  126  124  121
						 3000  131  131  130  129  126  124  121  121
						 4000  129  129  128  126  124  121  119  119
						 5000  127  126  125  124  121  119  116  116
						 6000  125  124  123  121  119  116  116  116
						 7000  122  122  120  118  116  114  114  114
						 8000  120  119  118  116  113  113  113  113
						 9000  118  117  116  114  112  112  112  112
						10000  116  115  113  112  110  110  110  110
					</tableData>
				</table>
			</function>
		</fcs_function>
		
		<fcs_function name="/systems/fms/speeds/vmcg-to"> <!-- From FCOM + Correction -->
			<function>
				<ifthen>
					<and>
						<gt>
							<property>/systems/fms/flight-data/airport-from-alt</property>
							<value>-2000</value>
						</gt>
						<gt>
							<property>/systems/fms/flight-data/oat-c</property>
							<value>-100</value>
						</gt>
					</and>
					<table>
						<independentVar lookup="row">/systems/fms/flight-data/airport-from-alt</independentVar>
						<independentVar lookup="column">/systems/fms/flight-data/oat-c</independentVar>
						<tableData>
							       15   20   25   30   35   40   45   50
							    0  137  136  136  136  134  131  129  126
							 1000  135  134  134  133  131  129  126  124
							 2000  133  132  132  131  129  126  124  121
							 3000  131  131  130  129  126  124  121  121
							 4000  129  129  128  126  124  121  119  119
							 5000  127  126  125  124  121  119  116  116
							 6000  125  124  123  121  119  116  116  116
							 7000  122  122  120  118  116  114  114  114
							 8000  120  119  118  116  113  113  113  113
							 9000  118  117  116  114  112  112  112  112
							10000  116  115  113  112  110  110  110  110
						</tableData>
					</table>
					<value>0</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<!-- V1 -->
		<fcs_function name="/systems/fms/speeds/v1-table"> <!-- From FCOM + Correction -->
			<function>
				<table>
					<independentVar lookup="row">/systems/fms/flight-data/togw-full-kg</independentVar>
					<independentVar lookup="column">/systems/fms/flight-data/to-flaps</independentVar>
					<tableData>
						        10   11   12   13   14   15   16   17   18   19   20   21   22   23   24   25   28
						160000  100  100   98   98   97   97   96   96   96   96   95   95   94   94   94   94   93
						165000  103  103  102  102  101  101  100  100   99   99   98   98   97   97   97   97   96
						170000  106  106  105  105  104  104  103  103  102  102  102  102  101  101  100  100   99
						175000  110  110  108  108  107  107  106  106  105  105  105  105  104  104  103  103  103
						180000  113  113  111  111  110  110  109  109  109  109  108  108  107  107  107  107  106
						185000  116  116  114  114  113  113  112  112  112  112  111  111  110  110  110  110  109
						190000  119  119  118  118  117  117  116  116  115  115  114  114  114  114  113  113  112
						195000  122  122  121  121  119  119  118  118  117  117  117  117  116  116  116  116  114
						200000  125  125  124  124  122  122  121  121  120  120  120  120  119  119  119  119  117
						205000  128  128  126  126  125  125  124  124  123  123  122  122  122  122  121  121  120
						210000  131  131  129  129  128  128  127  127  126  126  125  125  125  125  124  124  123
						215000  134  134  132  132  131  131  130  130  129  129  128  128  127  127  127  127  126
						220000  137  137  135  135  134  134  133  133  132  132  131  131  130  130  130  130  129
						225000  139  139  138  138  136  136  135  135  134  134  133  133  133  133  132  132  131
						230000  142  142  141  141  139  139  138  138  137  137  136  136  136  136  135  135  134
						235000  145  145  143  143  142  142  140  140  139  139  138  138  138  138  137  137  136
						240000  147  147  146  146  145  145  143  143  142  142  142  142  141  141  140  140  139
						245000  150  150  148  148  147  147  145  145  144  144  144  144  143  143  143  143  141
						250000  153  153  151  151  150  150  148  148  147  147  147  147  146  146  146  146  144
						255000  155  155  153  153  152  152  150  150  149  149  149  149  148  148  148  148  146
						260000  158  158  156  156  155  155  153  153  152  152  152  152  151  151  151  151  149
						265000  160  160  158  158  157  157  155  155  154  154  154  154  153  153  153  153  151
						270000  163  163  161  161  160  160  158  158  157  157  156  156  156  156  156  156  154
						275000  165  165  163  163  162  162  160  160  159  159  158  158  158  158  158  158  156
						280000  168  168  166  166  165  165  163  163  162  162  161  161  161  161  160  160  158
						285000  170  170  168  168  167  167  165  165  164  164  163  163  163  163  162  162  160
						290000  172  172  170  170  169  169  167  167  166  166  165  165  165  165  164  164  162
					</tableData>
				</table>
			</function>
		</fcs_function>
		
		<fcs_function name="/systems/fms/speeds/v1-delta">
			<function>
				<sum>
					<table>
						<independentVar lookup="row">/systems/fms/flight-data/airport-from-alt</independentVar>
						<tableData>
							    0   0
							10000  14
						</tableData>
					</table>
					<table>
						<independentVar lookup="row">/systems/fms/flight-data/oat-c</independentVar>
						<tableData>
							25   0
							60  10
						</tableData>
					</table>
				</sum>
			</function>
			<clipto>
				<min>0</min>
				<max>21</max>
			</clipto>
		</fcs_function>
		
		<fcs_function name="/systems/fms/speeds/v1-slope-wind-delta">
			<function>
				<sum>
					<product>
						<property>/systems/fms/flight-data/to-slope</property> <!-- -2 to 2 -->
						<value>3</value>
					</product>
					<table>
						<independentVar lookup="row">/systems/fms/flight-data/to-wind</independentVar>
						<tableData>
							-50 -10
							 50   5
						</tableData>
					</table>
				</sum>
			</function>
		</fcs_function>
		
		<fcs_function name="/systems/fms/speeds/v1">
			<function>
				<ifthen>
					<eq>
						<property>/systems/fms/flight-data/can-calc-vspeeds</property>
						<value>1</value>
					</eq>
					<max>
						<sum>
							<property>/systems/fms/speeds/v1-table</property>
							<property>/systems/fms/speeds/v1-delta</property>
							<property>/systems/fms/speeds/v1-slope-wind-delta</property>
						</sum>
						<property>/systems/fms/speeds/vmcg-to</property>
					</max>
					<value>0</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<!-- Vr -->
		<fcs_function name="/systems/fms/speeds/vr-table"> <!-- From FCOM + Correction -->
			<function>
				<table>
					<independentVar lookup="row">/systems/fms/flight-data/togw-full-kg</independentVar>
					<independentVar lookup="column">/systems/fms/flight-data/to-flaps</independentVar>
					<tableData>
						        10   11   12   13   14   15   16   17   18   19   20   21   22   23   24   25   28
						160000  126  126  125  125  123  123  122  122  121  121  120  120  119  119  119  119  117
						165000  129  129  128  128  126  126  125  125  124  124  123  123  122  122  122  122  120
						170000  132  132  131  131  129  129  128  128  127  127  126  126  125  125  125  125  123
						175000  135  135  134  134  132  132  131  131  130  130  129  129  128  128  128  128  126
						180000  138  138  136  136  135  135  134  134  133  133  132  132  131  131  130  130  128
						185000  141  141  139  139  138  138  137  137  136  136  135  135  134  134  133  133  131
						190000  144  144  142  142  140  140  139  139  138  138  137  137  136  136  135  135  133
						195000  147  147  145  145  143  143  142  142  141  141  140  140  139  139  138  138  136
						200000  149  149  147  147  145  145  144  144  143  143  142  142  141  141  140  140  139
						205000  152  152  150  150  148  148  147  147  146  146  145  145  144  144  143  143  142
						210000  154  154  152  152  150  150  149  149  148  148  147  147  146  146  145  145  144
						215000  156  156  154  154  153  153  151  151  150  150  149  149  148  148  147  147  146
						220000  158  158  156  156  155  155  153  153  152  152  151  151  150  150  149  149  147
						225000  161  161  159  159  157  157  156  156  155  155  154  154  153  153  152  152  149
						230000  163  163  161  161  159  159  158  158  157  157  156  156  155  155  154  154  151
						235000  166  166  163  163  161  161  160  160  159  159  158  158  157  157  156  156  154
						240000  168  168  165  165  164  164  162  162  161  161  160  160  159  159  158  158  156
						245000  170  170  168  168  166  166  164  164  163  163  162  162  161  161  160  160  158
						250000  172  172  170  170  168  168  166  166  165  165  164  164  163  163  162  162  160
						255000  174  174  172  172  170  170  168  168  167  167  166  166  165  165  164  164  162
						260000  176  176  174  174  172  172  170  170  169  169  168  168  167  167  166  166  163
						265000  178  178  176  176  174  174  172  172  171  171  170  170  169  169  168  168  165
						270000  180  180  178  178  176  176  174  174  173  173  172  172  171  171  170  170  167
						275000  182  182  180  180  178  178  176  176  175  175  174  174  173  173  172  172  169
						280000  184  184  182  182  180  180  178  178  177  177  176  176  175  175  174  174  171
						285000  186  186  183  183  181  181  180  180  178  178  177  177  176  176  175  175  172
						290000  187  187  184  184  182  182  181  181  179  179  178  178  177  177  176  176  173
					</tableData>
				</table>
			</function>
		</fcs_function>
		
		<fcs_function name="/systems/fms/speeds/vr-delta">
			<function>
				<sum>
					<table>
						<independentVar lookup="row">/systems/fms/flight-data/airport-from-alt</independentVar>
						<tableData>
							    0  0
							10000  7
						</tableData>
					</table>
					<table>
						<independentVar lookup="row">/systems/fms/flight-data/oat-c</independentVar>
						<tableData>
							25  0
							60  5
						</tableData>
					</table>
				</sum>
			</function>
			<clipto>
				<min>0</min>
				<max>10</max>
			</clipto>
		</fcs_function>
		
		<fcs_function name="/systems/fms/speeds/vr-calc">
			<function>
				<sum>
					<property>/systems/fms/speeds/vr-table</property>
					<property>/systems/fms/speeds/vr-delta</property>
				</sum>
			</function>
		</fcs_function>
		
		<fcs_function name="/systems/fms/speeds/vr">
			<function>
				<ifthen>
					<eq>
						<property>/systems/fms/flight-data/can-calc-vspeeds</property>
						<value>1</value>
					</eq>
					<max>
						<property>/systems/fms/speeds/vr-calc</property>
						<property>/systems/fms/speeds/v1</property>
						<property>/systems/fms/speeds/vmcg-to</property>
					</max>
					<value>0</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<!-- V2 -->
		<fcs_function name="/systems/fms/speeds/v2-table"> <!-- From FCOM + Correction -->
			<function>
				<table>
					<independentVar lookup="row">/systems/fms/flight-data/togw-full-kg</independentVar>
					<independentVar lookup="column">/systems/fms/flight-data/to-flaps</independentVar>
					<tableData>
						        10   11   12   13   14   15   16   17   18   19   20   21   22   23   24   25   28
						160000  149  149  148  148  146  146  145  145  143  143  142  142  142  142  141  141  138
						165000  151  151  150  150  148  148  147  147  145  145  144  144  144  144  143  143  140
						170000  153  153  151  151  150  150  148  148  147  147  146  146  145  145  144  144  142
						175000  155  155  153  153  152  152  150  150  149  149  148  148  147  147  146  146  144
						180000  157  157  155  155  153  153  152  152  151  151  149  149  149  149  148  148  145
						185000  159  159  157  157  155  155  154  154  153  153  151  151  151  151  150  150  147
						190000  160  160  158  158  157  157  155  155  154  154  153  153  152  152  151  151  148
						195000  162  162  160  160  159  159  157  157  156  156  155  155  154  154  153  153  150
						200000  164  164  162  162  160  160  159  159  157  157  156  156  155  155  154  154  151
						205000  166  166  164  164  162  162  161  161  159  159  158  158  157  157  156  156  153
						210000  167  167  165  165  164  164  162  162  161  161  159  159  158  158  158  158  155
						215000  169  169  167  167  166  166  164  164  163  163  161  161  160  160  159  159  156
						220000  170  170  168  168  167  167  165  165  164  164  162  162  161  161  160  160  157
						225000  172  172  171  171  169  169  167  167  166  166  164  164  163  163  162  162  159
						230000  173  173  172  172  170  170  168  168  167  167  165  165  164  164  163  163  160
						235000  175  175  174  174  172  172  170  170  169  169  167  167  166  166  165  165  162
						240000  177  177  175  175  173  173  172  172  170  170  169  169  168  168  167  167  164
						245000  179  179  177  177  175  175  174  174  172  172  171  171  170  170  169  169  166
						250000  180  180  178  178  176  176  175  175  173  173  172  172  171  171  170  170  167
						255000  182  182  180  180  178  178  177  177  175  175  174  174  173  173  172  172  169
						260000  184  184  182  182  179  179  178  178  176  176  175  175  174  174  173  173  170
						265000  186  186  184  184  181  181  180  180  178  178  177  177  176  176  175  175  172
						270000  187  187  185  185  183  183  181  181  180  180  178  178  177  177  176  176  173
						275000  189  189  187  187  185  185  183  183  181  181  180  180  179  179  178  178  175
						280000  190  190  188  188  186  186  184  184  182  182  181  181  180  180  179  179  176
						285000  192  192  190  190  188  188  186  186  184  184  183  183  182  182  181  181  178
						290000  193  193  191  191  189  189  187  187  185  185  184  184  183  183  182  182  179
					</tableData>
				</table>
			</function>
		</fcs_function>
		
		<fcs_function name="/systems/fms/speeds/vr-to-v2-delta">
			<function>
				<sum>
					<table>
						<independentVar lookup="row">/systems/fms/flight-data/airport-from-alt</independentVar>
						<tableData>
							    0  21
							10000  13
						</tableData>
					</table>
					<table>
						<independentVar lookup="row">/systems/fms/flight-data/oat-c</independentVar>
						<tableData>
							25  0
							60 -5
						</tableData>
					</table>
				</sum>
			</function>
			<clipto>
				<min>10</min>
				<max>21</max>
			</clipto>
		</fcs_function>
		
		<fcs_function name="/systems/fms/speeds/v2">
			<function>
				<ifthen>
					<eq>
						<property>/systems/fms/flight-data/can-calc-vspeeds</property>
						<value>1</value>
					</eq>
					<ifthen>
						<lt>
							<property>/systems/fms/speeds/vr-calc</property>
							<property>/systems/fms/speeds/vmcg-to</property>
						</lt>
						<sum>
							<property>/systems/fms/speeds/vmcg-to</property>
							<property>/systems/fms/speeds/vr-to-v2-delta</property>
						</sum>
						<property>/systems/fms/speeds/v2-table</property>
					</ifthen>
					<value>0</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<!-- Vfr -->
		<fcs_function name="/systems/fms/speeds/vfr">
			<function>
				<ifthen>
					<gt>
						<property>/systems/fms/speeds/v2</property>
						<value>0</value>
					</gt>
					<sum> <!-- Does not change if pilot overrides V2 -->
						<property>/systems/fms/speeds/v2</property>
						<value>10</value>
					</sum>
					<value>0</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<!-- Vsr -->
		<fcs_function name="/systems/fms/speeds/vsr"> <!-- From FCOM -->
			<function>
				<ifthen>
					<gt>
						<property>/systems/fms/flight-data/gw-full-kg</property>
						<value>0</value>
					</gt>
					<table>
						<independentVar lookup="row">/systems/fms/flight-data/gw-full-kg</independentVar>
						<tableData>
							160000  190
							165000  193
							170000  196
							175000  199
							180000  202
							185000  205
							190000  207
							195000  210
							200000  213
							205000  216
							210000  218
							215000  221
							220000  223
							225000  226
							230000  228
							235000  231
							240000  233
							245000  236
							250000  238
							255000  241
							260000  243
							265000  245
							270000  247
							275000  250
							280000  252
							285000  254
							290000  256
						</tableData>
					</table>
					<value>0</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<fcs_function name="/systems/fms/speeds/vsr-to"> <!-- From FCOM -->
			<function>
				<ifthen>
					<gt>
						<property>/systems/fms/flight-data/togw-full-kg</property>
						<value>0</value>
					</gt>
					<table>
						<independentVar lookup="row">/systems/fms/flight-data/togw-full-kg</independentVar>
						<tableData>
							160000  190
							165000  193
							170000  196
							175000  199
							180000  202
							185000  205
							190000  207
							195000  210
							200000  213
							205000  216
							210000  218
							215000  221
							220000  223
							225000  226
							230000  228
							235000  231
							240000  233
							245000  236
							250000  238
							255000  241
							260000  243
							265000  245
							270000  247
							275000  250
							280000  252
							285000  254
							290000  256
						</tableData>
					</table>
					<value>0</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<!-- Vcl -->
		<fcs_function name="/systems/fms/speeds/vcl"> <!-- From FCOM -->
			<function>
				<ifthen>
					<gt>
						<property>/systems/fms/flight-data/gw-full-kg</property>
						<value>0</value>
					</gt>
					<table>
						<independentVar lookup="row">/systems/fms/flight-data/gw-full-kg</independentVar>
						<tableData>
							160000  214
							165000  217
							170000  220
							175000  223
							180000  226
							185000  229
							190000  232
							195000  235
							200000  238
							205000  241
							210000  244
							215000  247
							220000  250
							225000  253
							230000  256
							235000  259
							240000  262
							245000  265
							250000  268
							255000  270
							260000  273
							265000  276
							270000  279
							275000  282
							280000  285
							285000  288
							290000  291
						</tableData>
					</table>
					<value>0</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<fcs_function name="/systems/fms/speeds/vcl-to"> <!-- From FCOM -->
			<function>
				<ifthen>
					<gt>
						<property>/systems/fms/flight-data/togw-full-kg</property>
						<value>0</value>
					</gt>
					<table>
						<independentVar lookup="row">/systems/fms/flight-data/togw-full-kg</independentVar>
						<tableData>
							160000  214
							165000  217
							170000  220
							175000  223
							180000  226
							185000  229
							190000  232
							195000  235
							200000  238
							205000  241
							210000  244
							215000  247
							220000  250
							225000  253
							230000  256
							235000  259
							240000  262
							245000  265
							250000  268
							255000  270
							260000  273
							265000  276
							270000  279
							275000  282
							280000  285
							285000  288
							290000  291
						</tableData>
					</table>
					<value>0</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<!-- Bank Limit -->
		<summer name="/systems/fms/speeds/vss-error">
			<input>/instrumentation/airspeed-indicator/indicated-speed-kt</input>
			<input>-/systems/fms/speeds/vss</input>
		</summer>
		
		<fcs_function name="/systems/fms/internal/bank-limit-vss">
			<function>
				<table>
					<independentVar lookup="row">/systems/fms/speeds/vss-error</independentVar>
					<tableData>
						 0.0   5
						12.5  30
					</tableData>
				</table>
			</function>
		</fcs_function>
		
		<fcs_function name="/systems/fms/internal/bank-limit-1"> <!-- From FCOM -->
			<function>
				<table>
					<independentVar lookup="row">/instrumentation/airspeed-indicator/indicated-mach</independentVar>
					<tableData>
						0.01  15
						0.17  25
						0.55  25
						0.80  20
						0.87  10
						0.93   0
					</tableData>
				</table>
			</function>
		</fcs_function>
		
		<fcs_function name="/systems/fms/internal/bank-limit-2"> <!-- From FCOM -->
			<function>
				<table>
					<independentVar lookup="row">/instrumentation/airspeed-indicator/indicated-mach</independentVar>
					<tableData>
						0.01  15
						0.17  25
						0.25  30
						0.55  30
						0.80  20
						0.87  10
						0.93   0
					</tableData>
				</table>
			</function>
		</fcs_function>
		
		<!-- Stabilizer Computer -->
		<fcs_function name="/systems/fms/internal/takeoff-stab-deg-calc">
			<function>
				<ifthen>
					<and>
						<gt>
							<property>/systems/fms/flight-data/tocg</property>
							<value>0</value>
						</gt>
						<gt>
							<property>/systems/fms/flight-data/to-flaps</property>
							<value>0</value>
						</gt>
					</and>
					<table>
						<independentVar lookup="row">/systems/fms/flight-data/tocg</independentVar>
						<independentVar lookup="column">/systems/fms/flight-data/to-flaps</independentVar>
						<tableData>
							    10    15    20    25    28
							12  10.1  10.5  10.9  11.1  11.2
							15   9.1   9.5   9.8  10.0  10.1
							20   7.4   7.8   8.0   8.2   8.3
							25   5.7   6.0   6.2   6.3   6.4
							30   4.0   4.3   4.4   4.5   4.6
							34   2.6   2.9   3.0   3.0   3.0
						</tableData>
					</table>
					<value>0</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<fcs_function name="/systems/fms/internal/takeoff-stab-deg">
			<function>
				<quotient>
					<floor>
						<sum>
							<product>
								<property>/systems/fms/internal/takeoff-stab-deg-calc</property>
								<value>10</value>
							</product>
							<value>0.5</value>
						</sum>
					</floor>
					<value>10</value>
				</quotient>
			</function>
		</fcs_function>
		
		<fcs_function name="/systems/fms/internal/takeoff-stab-error">
			<function>
				<difference>
					<quotient>
						<floor>
							<sum>
								<product>
									<property>/systems/fcs/stabilizer/final-deg</property>
									<value>-10</value> <!-- Because ANU = negative -->
								</product>
								<value>0.5</value> <!-- Make the integer rounded correctly -->
							</sum>
						</floor>
						<value>10</value>
					</quotient>
					<property>/systems/fms/internal/takeoff-stab-deg</property>
				</difference>
			</function>
		</fcs_function>
		
		<!-- Takeoff Flap Error -->
		<fcs_function name="/systems/fms/internal/takeoff-flaps-error">
			<function>
				<difference>
					<floor>
						<sum>
							<property>fcs/flap-pos-deg</property>
							<value>0.5</value> <!-- Make the integer rounded correctly -->
						</sum>
					</floor>
					<property>/systems/fms/flight-data/to-flaps</property>
				</difference>
			</function>
		</fcs_function>
		
		<!-- Opt/Max Flight Levels -->
		<fcs_function name="/systems/fms/internal/opt-fl">
			<function>
				<ifthen>
					<gt>
						<property>/systems/fms/flight-data/gw-kg</property>
						<value>0</value>
					</gt>
					<table>
						<independentVar lookup="row">/systems/fms/flight-data/gw-kg</independentVar>
						<tableData>
							150.487  430.000
							154.970  424.246
							160.031  417.886
							165.164  411.238
							170.080  404.589
							174.852  399.097
							179.985  392.882
							185.118  386.667
							190.034  380.741
							194.951  375.682
							200.084  370.334
							205.072  364.987
							210.061  359.639
							215.267  354.147
							220.038  349.377
							224.882  345.185
							230.088  340.560
							235.149  335.791
							240.137  331.021
							245.126  326.540
							250.042  322.493
							255.103  318.591
							260.092  315.122
							265.008  311.075
							270.069  307.028
							275.274  302.981
							280.000  299.000
						</tableData>
					</table>
					<value>0</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<fcs_function name="/systems/fms/internal/max-fl">
			<function>
				<ifthen>
					<gt>
						<property>/systems/fms/flight-data/gw-kg</property>
						<value>0</value>
					</gt>
					<table>
						<independentVar lookup="row">/systems/fms/flight-data/gw-kg</independentVar>
						<tableData>
							167.639  430.000
							170.163  426.877
							174.936  421.138
							179.997  414.634
							185.118  408.347
							190.034  402.566
							194.951  396.784
							200.084  391.003
							205.072  385.800
							210.061  380.741
							215.267  375.538
							220.038  371.057
							225.027  366.143
							230.088  360.073
							235.149  357.037
							240.137  352.990
							245.126  348.510
							250.042  344.318
							255.175  340.127
							260.092  336.080
							265.008  332.033
							270.069  327.986
							275.202  324.083
							280.000  320.000
						</tableData>
					</table>
					<value>0</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<!-- PERF Calculations -->
		<fcs_function name="/systems/fms/speeds/max-climb">
			<function>
				<ifthen>
					<gt>
						<property>/systems/fms/flight-data/gw-kg</property>
						<value>0</value>
					</gt>
					<table>
						<independentVar lookup="row">/systems/fms/flight-data/gw-kg</independentVar>
						<tableData>
							140  219
							280  306
						</tableData>
					</table>
					<value>0</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<fcs_function name="/systems/fms/speeds/max-descent">
			<function>
				<difference>
					<property>/systems/fms/speeds/vmo-mmo</property>
					<value>5</value>
				</difference>
			</function>
		</fcs_function>
		
		<fcs_function name="/systems/fms/speeds/econ-kts">
			<function>
				<ifthen>
					<and>
						<gt>
							<property>/systems/fms/flight-data/cruise-fl</property>
							<value>0</value>
						</gt>
						<gt>
							<property>/systems/fms/flight-data/cost-index</property>
							<value>-1</value>
						</gt>
						<gt>
							<property>/systems/fms/flight-data/gw-kg</property>
							<value>0</value>
						</gt>
					</and>
					<table>
						<independentVar lookup="row">/systems/fms/flight-data/cost-index</independentVar>
						<independentVar lookup="column">/systems/fms/flight-data/gw-kg</independentVar>
						<tableData>
							     140  280
							  0  296  318
							 80  323  350
							160  350  350
						</tableData>
					</table>
					<value>0</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<fcs_function name="/systems/fms/speeds/econ-mach">
			<function>
				<ifthen>
					<and>
						<gt>
							<property>/systems/fms/flight-data/cruise-fl</property>
							<value>0</value>
						</gt>
						<gt>
							<property>/systems/fms/flight-data/cost-index</property>
							<value>-1</value>
						</gt>
						<gt>
							<property>/systems/fms/flight-data/gw-kg</property>
							<value>0</value>
						</gt>
					</and>
					<sum>
						<value>0.82</value> <!-- Basic mach number -->
						<table> <!-- CI and GW modifier -->
							<independentVar lookup="row">/systems/fms/flight-data/cost-index</independentVar>
							<independentVar lookup="column">/systems/fms/flight-data/gw-kg</independentVar>
							<tableData>
								     140    280
								  0 -0.029 -0.016
								 80  0.002  0.013
								160  0.013  0.026
							</tableData>
						</table>
						<table> <!-- Cruise level modifier -->
							<independentVar lookup="row">/systems/fms/flight-data/cruise-fl</independentVar>
							<tableData>
								  0 -0.349
								 50 -0.282
								100 -0.215
								150 -0.148
								200 -0.081
								250 -0.024
								300  0.000
								350  0.006
								400  0.007
								450  0.008
							</tableData>
						</table>
					</sum>
					<value>0</value>
				</ifthen>
			</function>
		</fcs_function>
	
	</channel>

</system>
